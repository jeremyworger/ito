"use strict";!function(){var e={IN:"in",OUT:"out"},r={LOW:0,HIGH:1},n=function(e){this.init(e)};n.prototype={init:function(e){window.WorkerOvserve.notify("gpio",{method:"gpio.export",portNumber:e}),this.portNumber=e,this.portName="",this.pinName="",this.direction="",this.exported=!1,this.value=null,this._DEVICES="CHIRIMEN"},"export":function(r){var n=this,t=function(e){"function"==typeof n.onchange&&n.onchange(e.value)},o=function(o,i){r===e.OUT||r===e.IN?(window.WorkerOvserve.notify("gpio",{method:"gpio.setDirection",portNumber:n.portNumber,direction:r===e.OUT}),r===e.IN?window.WorkerOvserve.observe("gpio.onchange."+n.portNumber,t):window.WorkerOvserve.unobserve("gpio.onchange."+n.portNumber,t),o()):i(new Error("InvalidAccessError"))},i=function(e){return n.direction=r,n.exported=!0,n.pinName=s[n._DEVICES].PORTS[n.portNumber].pinName,n.portName=s[n._DEVICES].PORTS[n.portNumber].portName,e},p=function(e){return n.direction="",n.exported=!1,n.pinName="",n.portName="",Promise.reject(e)};return new Promise(o).then(i)["catch"](p)},unexport:function(e){},read:function(){var e=this,r=function(r,n){e.exported?e.__isInput()||n(new Error("OperationError")):n(new Error("InvalidAccessError")),r()},n=function(){return new Promise(function(r,n){window.WorkerOvserve.observe("gpio.getValue."+e.portNumber,function(e){r(e.value)}),window.WorkerOvserve.notify("gpio",{method:"gpio.getValue",portNumber:e.portNumber})})};return new Promise(r).then(n)},write:function(e){var n=this,t=function(t,o){n.exported?n.__isOutput()?e!==r.LOW&&e!==r.HIGH&&o(new Error("OperationError")):o(new Error("OperationError")):o(new Error("InvalidAccessError")),t()},o=function(){return n.value=e,window.WorkerOvserve.notify("gpio",{method:"gpio.setValue",portNumber:n.portNumber,value:n.value}),n.value};return new Promise(t).then(o)},onchange:null,__isInput:function(){return this.direction===e.IN},__isOutput:function(){return this.direction===e.OUT}};var t=function(e){this.init(e)};t.prototype={init:function(e){var r=this;this.ports=new o;var t=function(e){return parseInt(e,10)},i=function(e){return function(){return new Promise(function(t){window.WorkerOvserve.observe("gpio.export."+e,function(){return t()}),r.ports.set(e,new n(e))})}},p=function(e,r){return e.then(r)};this.GPIOAccessThen=Object.keys(s.CHIRIMEN.PORTS).map(t).map(i).reduce(p,Promise.resolve())},ports:null,unexportAll:null,onchange:null};var o=Map;navigator.requestGPIOAccess||(navigator.requestGPIOAccess=function(){var e=new t;return e.GPIOAccessThen.then(function(){return e})});var i=function(e){return JSON.parse(String.fromCharCode.apply(null,new Uint16Array(e)))},p=function(e){for(var r=JSON.stringify(e),n=new ArrayBuffer(2*r.length),t=new Uint16Array(n),o=0,i=r.length;o<i;o++)t[o]=r.charCodeAt(o);return t};if(window.WorkerOvserve=window.WorkerOvserve||function(){function e(){this._Map=new Map}return e.prototype.observe=function(e,r){var n=this._Map.get(e)||[];n.push(r),this._Map.set(e,n)},e.prototype.unobserve=function(e,r){var n=this._Map.get(e)||[];this._Map.set(e,n.filter(function(e){return e!==r}))},e.prototype.notify=function(e){var r=Array.prototype.slice.call(arguments,1);(this._Map.get(e)||[]).forEach(function(e,n){e.apply(null,r)})},new e}(),window.Worker){var a=function(){if(document.currentScript)return document.currentScript.src;var e=document.getElementsByTagName("script"),r=e[e.length-1];return r.src?r.src:void 0}(),u=new Worker(a.substr(0,a.lastIndexOf("/"))+"/worker.js");window.WorkerOvserve.observe("gpio",function(e){var r=p(e);u.postMessage(r.buffer,[r.buffer])}),window.WorkerOvserve.observe("i2c",function(e){var r=p(e);u.postMessage(r.buffer,[r.buffer])}),u.onmessage=function(e){var r=i(e.data);window.WorkerOvserve.notify(r.method,r)}}var s={CHIRIMEN:{PORTS:{283:{portName:"CN1.UART3_RX",pinName:"4"},284:{portName:"CN1.UART3_TX",pinName:"5"},196:{portName:"CN1.SPI0_CS",pinName:"7"},197:{portName:"CN1.SPI0_CLK",pinName:"8"},198:{portName:"CN1.SPI0_RX",pinName:"9"},199:{portName:"CN1.SPI0_TX",pinName:"10"},244:{portName:"CN1.SPI1_CS",pinName:"11"},243:{portName:"CN1.SPI1_CLK",pinName:"12"},246:{portName:"CN1.SPI1_RX",pinName:"13"},245:{portName:"CN1.SPI1_TX",pinName:"14"},163:{portName:"CN2.PWM0",pinName:"10"},193:{portName:"CN2.UART0_TX",pinName:"13"},192:{portName:"CN2.UART0_RX",pinName:"14"},353:{portName:"CN2.GPIO6_A1",pinName:"15"}},I2C_PORTS:{0:{SDA:{portName:"CN2.I2C0_SCL",pinName:"11"},SCL:{portName:"CN2.I2C0_SDA",pinName:"12"}},2:{SDA:{portName:"CN1.I2C2_SDA",pinName:"2"},SCL:{portName:"CN1.I2C2_SCL",pinName:"3"}}}}}}();